<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="PHP,Laravel,thinkPHP,javascript,css">
<meta property="og:type" content="website">
<meta property="og:title" content="easy note">
<meta property="og:url" content="http://blog.slpi1.com/page/4/index.html">
<meta property="og:site_name" content="easy note">
<meta property="og:description" content="PHP,Laravel,thinkPHP,javascript,css">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="easy note">
<meta name="twitter:description" content="PHP,Laravel,thinkPHP,javascript,css">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://blog.slpi1.com/page/4/"/>





  <title>easy note</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">easy note</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">easy note</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.slpi1.com/20210219/discuss/package.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="slpi1">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="easy note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/20210219/discuss/package.html" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-02-19T15:44:38+08:00">
                2021-02-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="如何进行代码结构的规划"><a href="#如何进行代码结构的规划" class="headerlink" title="如何进行代码结构的规划"></a>如何进行代码结构的规划</h1><h1 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h1><ul>
<li><a href="#层">层</a><ul>
<li><a href="#从MVC谈起">从MVC谈起</a><ul>
<li><a href="#MVC的变种">MVC的变种</a></li>
<li><a href="#分层带来的问题">分层带来的问题</a></li>
</ul>
</li>
<li><a href="#AOP与MVC">AOP与MVC</a></li>
<li><a href="#一个例子">一个例子</a></li>
</ul>
</li>
<li><a href="#模块">模块</a><ul>
<li><a href="#如何构建一个模块">如何构建一个模块</a><ul>
<li><a href="#要解决的问题">要解决的问题</a></li>
<li><a href="#提供的接口">提供的接口</a></li>
<li><a href="#模块的引用方式">模块的引用方式</a></li>
<li><a href="#必要的说明文档">必要的说明文档</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#其他">其他</a></li>
</ul>
<h1 id="层"><a href="#层" class="headerlink" title="层"></a>层</h1><h2 id="从MVC谈起"><a href="#从MVC谈起" class="headerlink" title="从MVC谈起"></a>从MVC谈起</h2><p>从最开始接触到web编程时，MVC是使用的最多的模型，在当时的一众CMS中，大多都会打着MVC、OOP等旗号推向市场。MVC从何而起，不必深究，只需要知道，他是一种可以指导我们对代码进行规划的模型。如果你的项目中有太多无处安放的代码，那么，用MVC去盘他，总能找到他们合适的位置。</p>
<p>再后来接触到ThinkPHP的时候，又了解到了AOP面向切面编程，“切面”又成了一种可选的组织代码的模型。如果把MVC看做是纵向的拆分方式，那么切面就是横向的拆分方式。这两种模型，都可以在目前的框架中找到其实现，可以作为我们自身代码结构规划的指导思想。</p>
<h3 id="MVC的变种"><a href="#MVC的变种" class="headerlink" title="MVC的变种"></a>MVC的变种</h3><p>然而，凡事没有银弹，不存在一个方法可以完美解决世界上的所有问题，MVC与AOP也不例外。由于当前web开发中，后台的业务变得更为复杂，不再只是以前简单的增删改查，一味往MVC上靠，已经变得不可取了。再加上前后端分离的趋势，后端实际只剩MC两层，将复杂的业务逻辑编码到MC两层中，必然导致某一层变得臃肿庞大，日渐难以维护。由此，有一种思路是将MC继续拆分，引入Service,Repository两层，分别与Controller和Model进行对接，使项目代码分为四层：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Controller -&gt; Service -&gt; Repositroy -&gt; Model</span><br></pre></td></tr></table></figure></p>
<p>还可以根据项目自身情况来决定，只引人Service或Repository中的一层，从而解决某一层过大的问题。依据这一思路，其实可以规划出更多的层级来组织代码，不怕你业务逻辑多复杂，就怕你层级分的不够多。</p>
<h3 id="分层带来的问题"><a href="#分层带来的问题" class="headerlink" title="分层带来的问题"></a>分层带来的问题</h3><p>将MVC继续细分，固然是解决方案之一，但同时也带来了一些问题，比如：</p>
<ul>
<li>层级与层级之间的划分依据是什么？</li>
<li>如果某个操作逻辑比较简单，可否跨级调用？</li>
</ul>
<p>这些问题可能不会有一个标准的答案，而是需要在决定如此分层时，进行统一约束与定义。即使是进行了定义，也会有：如果层级之间的划分依据不明确，会导致层级与层级之间的边界变得模糊；如果可以进行跨级调用，除了导致层级之边界模糊外，还会使人重新思考，层级划分的意义何在？但是反过来，如果层级的划分依据过于明确，是否可以适用于大多数场景？禁止跨级调用，是否会导致无用代码的增加？等等系列问题。</p>
<h2 id="AOP与MVC"><a href="#AOP与MVC" class="headerlink" title="AOP与MVC"></a>AOP与MVC</h2><p>上文我们提到过，如果把MVC看做是纵向的拆分方式，那么切面就是横向的拆分方式。就像是代码执行到某个分叉口时，既要横向执行，又要纵向执行，但众所周知，PHP是单线程的，串行执行，不存在分叉一说，所谓切面，实际上就是插队，将“切面”上编码的内容，插入到钩子设置的切面点上执行，然后继续MVC这条线的执行。</p>
<p>如果我们将“切面”看做是我们分的一个层的话，那么，这一层在执行中到底存不存在，实际上由是否在代码中设置了钩子来决定的。如此看来，刚才我们讨论的分层带来的问题，仿佛有了解决办法，至少，不存在跨级调用的这个问题。</p>
<p>“切面”是层的另一种形态，是某一层中的一个细节。当某一层中的“切面”大量出现时，就应该考虑将切面进行归纳总结，是否来划分成一个“层”了。</p>
<p>至此我们可以总结：</p>
<ul>
<li>在使用MVC这种模型规划代码时，初期可以不必划分过多的层级，通过引入切面这一模型，来进行调节，然后在合适的时机划分出下一个层级。</li>
<li>通过“层”的维度对代码整体进行划分，是个不错的选择。除此之外，还可以通过模块的方式，对代码进行划分。</li>
</ul>
<h2 id="一个例子"><a href="#一个例子" class="headerlink" title="一个例子"></a>一个例子</h2><p>我以做过的一个项目，美术数据驾驶舱，来举例，简单说明一下我是如何进行分层及依据的。 <a href="https://gitlab.uuzu.com/v.songzp/ArtDataDoc" target="_blank" rel="noopener">文档</a></p>
<p>从Controller到Model，这个项目分了这些层次:</p>
<ul>
<li>Controller: 接收请求的参数；确定用于筛选数据的“应用数据”对象</li>
<li>Charts/Exports/TableViewers: 应用数据层。根据上层传递的参数及数据展现型式，查询并组合出指定型式的数据，如：图表型数据、表格型数据、Excel文件数据。对于图表型数据，需要将数据转化成适配EChart的数据格式，如果是表格型数据、Excel文件数据，需要对表格单元格进行合并。</li>
<li>TablePrototypes： 表格原型数据层。如果应用数据层是Exports/TableViewers，需要经过这一层。根据上层传递的参数，查询数据并组合成原始表格格式的数据</li>
<li>Data： 基础数据层。根据上层传递的参数，查询所需要的数据，这一层的数据都是简单的<code>键-&gt;值</code>单元，一个上层的调用，在这一层可能会查询出很多组相同主键的<code>键-&gt;值</code>单元，然后上层会根据主键，组合成表一样的数据。</li>
<li>Model： 数据库层。</li>
</ul>
<h1 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h1><p>模块是区别于层的，从另外一个维度划分代码时，提出的一个概念，与之平行的还有库、包等概念。在说起模块时，可以暂时忘掉我们上文对于层的讨论。</p>
<p>在使用php的过程中，如果说有什么能帮助你理解模块的概念的话，那莫过于composer了。通常我们使用composer来为项目安装依赖后，可能会在任何地方使用到这些依赖。他们大多都是，为了解决某一范围内的问题，提炼出的一套接口。</p>
<p>然而，使用composer安装的依赖都集中在vendor目录中，日常开发中很少会去注意到这里面都有些什么，似乎并不会对我们自己组织代码时起到什么指导作用。对此，我们来说道说道。</p>
<h2 id="如何构建一个模块"><a href="#如何构建一个模块" class="headerlink" title="如何构建一个模块"></a>如何构建一个模块</h2><h3 id="要解决的问题"><a href="#要解决的问题" class="headerlink" title="要解决的问题"></a>要解决的问题</h3><p>一个模块，必须要有他的边界，有他要着重解决的问题。如果你想把所有问题都放到一个模块中，那么，这个模块实际就是你正在开发的项目了。所以，在构建一个模块时，首先要考虑的是：你打算用他来解决项目中的哪个问题？</p>
<ul>
<li>由于需要调用其他服务的接口，所以我们划分出了HttpClient模块，来专门处理http请求发送与响应的问题。</li>
<li>由于需要生成图片的缩略图，所以我们划分出了Image模块，来专门处理缩略图生成的问题，后来我们又需要给图片加水印、需要获取图片宽高等信息等等</li>
</ul>
<h3 id="提供的接口"><a href="#提供的接口" class="headerlink" title="提供的接口"></a>提供的接口</h3><p>在明确模块需要解决的问题后，下一步就要定义为了解决这些问题、模块所提供的接口。在解决这一问题时，所需要的上下文信息，都应该通过接口的参数传递过来，尽可能避免在处理问题的过程中，再次向外部获取参数。与之对应，接口的返回也是要明确定义的，如果返回的是一个对象，那么应该始终返回一个对象，不会因为参数传递的区别，导致返回值类型的差异。</p>
<p>其实，这一条可以作为大多数函数参数与返回值的标准，虽然不是必须遵守的，但是如果你的模块，有可能被抽象出来，广泛运用到其他项目中，最好严格遵守这一条。因为你不知道别人调用你的接口之后，到底会不会对返回值进行检查，如果没有而你又恰巧返回了其他类型的值，就可能导致代码运行出错。</p>
<h3 id="模块的引用方式"><a href="#模块的引用方式" class="headerlink" title="模块的引用方式"></a>模块的引用方式</h3><p>一般来说，一个模块有一个公共的出口对象，所有的接口都由这个公共对象来调用，是一个比较好的模式。这样在引用模块时，只需要实例化该对象即可。</p>
<h3 id="必要的说明文档"><a href="#必要的说明文档" class="headerlink" title="必要的说明文档"></a>必要的说明文档</h3><p>主要介绍模块的引用方式以及接口使用说明</p>
<h3 id="内部模块与外部模块"><a href="#内部模块与外部模块" class="headerlink" title="内部模块与外部模块"></a>内部模块与外部模块</h3><p>使用composer安装的依赖，我们可以称之为外部模块，与之对应的内部模块，就是我们项目中封装的模块了。内部模块公用同一个命名空间即可。</p>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>代码结构的规划，说到底其实就是封装的过程。无论是层级的划分，还是模块的划分，都会遇到边界的问题，封装的过程，就是要明确问题的边界。这需要一些设计模式相关知识的储备，也需要进行大量编码的实践，没法一蹴而就，如果从现在开始，试着将函数与方法尽量进行拆分，坚持一段时间，或多或少都会提高自己对代码封装的理解。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.slpi1.com/20210219/discuss/excel-merge-cell.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="slpi1">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="easy note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/20210219/discuss/excel-merge-cell.html" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-02-19T15:44:38+08:00">
                2021-02-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Excel单元格自动合并的实现方案"><a href="#Excel单元格自动合并的实现方案" class="headerlink" title="Excel单元格自动合并的实现方案"></a>Excel单元格自动合并的实现方案</h1><h1 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h1><ul>
<li><a href="#背景">背景</a></li>
<li><a href="#思路">思路</a><ul>
<li><a href="#找出合并的隐含条件">找出合并的隐含条件</a></li>
<li><a href="#可合并区域的寻找">可合并区域的寻找</a></li>
<li><a href="#可合并区域的影响">可合并区域的影响</a></li>
<li><a href="#结束条件">结束条件</a></li>
<li><a href="#其他问题">其他问题</a><ul>
<li><a href="#三角形问题">三角形问题</a></li>
<li><a href="#起始点的合并顺序">起始点的合并顺序</a></li>
<li><a href="#我们如何引入自定义条件">我们如何引入自定义条件</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#点睛之笔-自定义条件">点睛之笔-自定义条件</a><ul>
<li><a href="#停止行与停止列">停止行与停止列</a></li>
<li><a href="#继承">继承</a></li>
<li><a href="#合并优先序">合并优先序</a></li>
</ul>
</li>
<li><a href="#实现">实现</a><ul>
<li><a href="#基本对象">基本对象</a><ul>
<li><a href="#单元格对象">单元格对象</a></li>
<li><a href="#区域对象">区域对象</a></li>
<li><a href="#数据源对象">数据源对象</a></li>
<li><a href="#搜索执行对象">搜索执行对象</a></li>
<li><a href="#停止规则对象">停止规则对象</a></li>
</ul>
</li>
<li><a href="#执行过程">执行过程</a><ul>
<li><a href="#合并的初始化与进行">合并的初始化与进行</a></li>
<li><a href="#停止行规则">停止行规则</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>以前在开发有格数据驾驶舱的时候，由于需要展示比较多的表格，而且表格有合并的情况，每个表格的合并规则还不一致。当时需要同时支持导出 <code>Excel</code> 文件的合并，以及返回到接口的数据，供前端展示时合并，这两种情况。通过分析之后，计划通过两种方案来实现：</p>
<ul>
<li><code>Excel</code> 模板。模板包含要合并的情况，导出时仅填充数据。</li>
<li>动态合并规则。按要求，自动对数据项进行合并。</li>
</ul>
<p>通过模板的方式来解决这个问题，需要面以下下困难：</p>
<ul>
<li>如果合并的情况比较复杂，比如前十行与后十行的合并情况不一致，更进一步，如果这个“十”是变化的，那么模板就无能为力了。</li>
<li>返回给前端接口的表格数据，无法共模板这一方案，需要单独想办法解决</li>
</ul>
<p>由于上述两个原因，决定采用方案二，动态合并规则来实现。总的概括一下我们要解决的问题：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">任意给定一组二维数据，根据自定义的一些规则，来对这组数据进行合并，并列出所有合并区域的起点与终点。</span><br></pre></td></tr></table></figure>
<h1 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h1><p>如何找出需要合并的区域呢？先假设一个无规则的情况；如果有一个表格，你可以自由的对表格数据进行合并，要如何实现？</p>
<h2 id="找出合并的隐含条件"><a href="#找出合并的隐含条件" class="headerlink" title="找出合并的隐含条件"></a>找出合并的隐含条件</h2><p>在无规则情况下，其实默认单元格满足下列两个条件，就可以进行合并：</p>
<ul>
<li>两个单元格的值相等</li>
<li>两个单元格的位置相邻</li>
</ul>
<h2 id="可合并区域的寻找"><a href="#可合并区域的寻找" class="headerlink" title="可合并区域的寻找"></a>可合并区域的寻找</h2><p>那么，合并区域的寻找，可以通过以下过程来展开：</p>
<ul>
<li>确定起点：确定数据的起点，假设为 <code>O(0,0)</code>，标记点 <code>O</code> 为合并的起点</li>
<li>横向检查：检查 <code>O</code> 右侧的点 <code>N(0,1)</code>，如果点 <code>O</code> 与点 <code>N</code> 的值相等，那么表示可以合并，继续检查 <code>N</code> 右侧的点 <code>N1</code>，直到 <code>Nx</code> 的值不等于 <code>O</code> 的值，至此，横向检查完毕</li>
<li>纵向检查：检查 <code>O</code> 下方的点 <code>H(1,0)</code>, 如果点 <code>O</code> 与点 <code>H</code> 的值相等，那么从 <code>H</code> 点开始，启动第二轮横向检查。如果不想等，那么合并结束，合并区域为 <code>O~Nx-1</code> 。 <code>Nx-1</code> 表示最后一轮横向检查的终点。</li>
</ul>
<p>这个过程是一次合并区域检查的过程，每执行一个这样的过程，就会得到一个合并区域，记作 <code>Range[O,Nx-1]</code>，如果点 <code>O</code> 与点 <code>Nx-1</code> 相等，说明该合并区域就是一个点，可以舍弃掉。</p>
<h2 id="可合并区域的影响"><a href="#可合并区域的影响" class="headerlink" title="可合并区域的影响"></a>可合并区域的影响</h2><p>每寻找到一个合并区域 <code>Range[O,Nx-1]</code> ,我们就消除了一个起点，同时，得到了两个新的起点。由于合并区域是一个矩形，矩形有四个点，其中一个是我们选择的起始点，还剩下三个点，由于对角线上的点比较特殊，我们先抛开不谈，还剩下起始点相邻的两个点，这两个点，就是下一次合并的起始点。<br>假设合并区域的终点为 <code>Nx-1(m,n)</code>，那么，由点 <code>O</code> 分裂出两个新的起始点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O(0,0) -&gt; O1(0,n), O2(m,0)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>由于合并起始点需要进行一个单位的偏移，对角点会偏移成三个点。但这三个点都有可能被相邻两个点的区域所包含，也有可能不会包含。将对角点考虑进来讨论的话，会大大的增加问题的复杂性，但并不会对结果有积极的意义，弊大于利，所以讨论与编码时，都将这个点忽略</p>
</blockquote>
<p>接下来，我们继续以 <code>O1/O2</code> 为起始点，分别进行可合并区域的寻找，就能又找到两个可合并区域，以及，分裂成四个新的起始点。</p>
<h2 id="结束条件"><a href="#结束条件" class="headerlink" title="结束条件"></a>结束条件</h2><p>根据上述分析，我们会发现，随着可合并区域不断被找出，起始点不断被分裂成更多的起始点。那么这个循环会一直持续下去吗？并不是，当分裂到数据的边界的时候，一个起始点就只会分裂成一个起始点，这时，起始点的规模就会开始收缩。那么，“数据的边界”，包含哪些情况呢？</p>
<ul>
<li>数据的范围达到给定范围的极限，就是，数据右边或下边没有更多数据了。</li>
<li>数据的范围，触及到某个已找到的可合并区域的边界。显然，由此分裂出的开始点，已经被“寻找过”，并不会产生新的可合并区域。</li>
</ul>
<p>当所有的起始点，都触碰到数据的边界的时候，查找，就结束了，已找到的可合并区域，就是给定数据中，所有的可合并区域。</p>
<h2 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h2><p>我们按照上述思路，已经归纳出了方案的基本雏形，只不过在实际使用中，可能并不会达到我们想要的结果，因为这当中忽略了几个比较重要的问题。</p>
<h3 id="三角形问题"><a href="#三角形问题" class="headerlink" title="三角形问题"></a>三角形问题</h3><p>如果数据中有一个三角形区域 <code>O(0,0) -&gt; A(0,10) -&gt; B(10, 0)</code> 其中所有的单元格的值都相等，按照上述思路，最终寻找的可合并区域是 <code>Range[O(0,0), B(10,0)]</code>，因为我们在可合并区域的寻找过程中，遵循的是“横向合并优先”，如果我们遵循“纵向合并优先”的话，最终需要的可合并区域是 <code>Range[O(0,0), A(0, 10)]</code>，然而实际当中，也许这两种情况，都不是我们希望的结果，比如，若我希望合并区域有最大的面积，那么，最终的可合并区域应该是 <code>Range[O(0,0), M(5,5)]</code>。究竟应该如何取舍，实际上取决于“我们的要求”。</p>
<h3 id="起始点的合并顺序"><a href="#起始点的合并顺序" class="headerlink" title="起始点的合并顺序"></a>起始点的合并顺序</h3><p>由于起始点是会逐渐分裂增加的，那么，依据什么来决定，哪个起始点优先进入合并队列呢？考虑一种极端情况，第一个可合并区域将整个数据分成了两个部分：可合并区域的数据都是1，剩下部分的数据，都是2。如果称可合并区域为第二象限，那么以右侧的点开始，得到的合并区域是第一象限与第四象限的组合；如果以下侧的点，开始，得到的合并区域是第三象限与第四象限的组合。所以，起始点的选取顺序，也会导致合并区域结果的差异。</p>
<h3 id="我们如何引入自定义条件"><a href="#我们如何引入自定义条件" class="headerlink" title="我们如何引入自定义条件"></a>我们如何引入自定义条件</h3><p>到此为止，我们上述的讨论，都不涉及到自定义条件的问题，而这本身就是需求之一。</p>
<h1 id="点睛之笔-自定义条件"><a href="#点睛之笔-自定义条件" class="headerlink" title="点睛之笔-自定义条件"></a>点睛之笔-自定义条件</h1><p>如果讨论至于上述的思路，那么这一方案实际上并无太大用处，因为由于最后三个问题的存在，导致最终合并的结果，很有可能并不是我们想要的。其中，第三个问题，它既是一个问题，又是一个需求，那么，考虑在解决该问题的同时，附带解决其余两个问题。我们将上文的思路，归纳成两个过程：</p>
<ul>
<li>寻找合并区域</li>
<li>循环起始点</li>
</ul>
<p>从顺序上看，<code>寻找合并区域</code> 先于 <code>循环起始点</code> ，从因果关系上看，<code>寻找合并区域</code> 会导致 <code>循环起始点</code> 的主体 <code>起始点</code> 起始点的变化。所以我们先考虑从 <code>寻找合并区域</code> 这一过程中，引入自定义条件。 <code>寻找合并区域</code> 分为两个主要过程，<code>横向检查</code> 与 <code>纵向检查</code>，我们引入的条件，应该是能影响这两个过程的结束位置。</p>
<p>对于上述 <code>三角形问题</code> ,如果我们要求可合并区域的面积最大，可以转化为这样的一组条件：</p>
<ul>
<li>横向合并到 <code>5</code> 为止</li>
<li>纵向合并到 <code>5</code> 为止</li>
</ul>
<p>这里的两个条件，就是我们的自定义条件，我们把这类条件，归纳为 <code>停止行/停止列</code></p>
<h2 id="停止行与停止列"><a href="#停止行与停止列" class="headerlink" title="停止行与停止列"></a>停止行与停止列</h2><p>停止行与停止列，是自定义条件的核心。他规定合并区域的寻找，在遇到哪些行与列的时候，就停止。因此，我们只需要在寻找合并区域的逻辑当中，引入对停止行与停止列的检查即可。需要留意的是，停止行与停止列的位置可能是变化的，我们在编码时可能需要考虑到这一点。</p>
<h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><p>停止行与停止列可能需要被继承，他所代表的含义是：表格前面部分的停止规则，极有可能对后面的数据生效，但是根据后面的数据以及规则，可能无法计算出合适的停止规则，这时，直接将前面的停止规则继承过来即可。</p>
<h2 id="合并优先序"><a href="#合并优先序" class="headerlink" title="合并优先序"></a>合并优先序</h2><p>我们在讨论 <code>三角形问题</code> 时，提到过 <code>横向合并优先/纵向合并优先</code> 的概念，这是指在寻找合并区域时遇到的顺序问题。在循环起始点时，也存在这么一个问题：即应该以左侧的点开始新一轮的合并区域寻找，还是应该以下侧的点，开始新一轮的合并区域寻找。这是两个合并优先序的问题。</p>
<p>先来看一看起始点的分裂情况，假设有以下分裂过程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">O(0,0) -&gt; [N(2, 0),H(0,2)]</span><br><span class="line"></span><br><span class="line">N(2, 0) -&gt; [N1(5, 0), H1(2,3)]; H(0, 2) -&gt; [N2(1, 2), H2(0, 4)]</span><br></pre></td></tr></table></figure>
<p>起始点出现的顺序是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">N - H - N1 - H1 - N2 - H2</span><br></pre></td></tr></table></figure>
<p>分布大概如下表所示</p>
<table>
<thead>
<tr>
<th>0 O(0,0)</th>
<th>1</th>
<th>2 N(2, 0)</th>
<th>3</th>
<th>4</th>
<th>5 N1(5,0)</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>—</td>
<td>—</td>
<td>—</td>
<td>—</td>
<td>—</td>
</tr>
<tr>
<td>2 H(0,2)</td>
<td>N2(1,2)</td>
<td>—</td>
<td>—</td>
<td>—</td>
<td>—</td>
</tr>
<tr>
<td>3</td>
<td>—</td>
<td>H1(2,3)</td>
<td>—</td>
<td>—</td>
<td>—</td>
</tr>
<tr>
<td>4 H2(0,4)</td>
<td>—</td>
<td>—</td>
<td>—</td>
<td>—</td>
<td>—</td>
</tr>
<tr>
<td>5</td>
<td>—</td>
<td>—</td>
<td>—</td>
<td>—</td>
<td>—</td>
</tr>
</tbody>
</table>
<p>如果以开始点出现的顺序进行合并，通过相对位置可知，点 <code>H1</code> 可能会被包含在 <code>N2</code> 开始的可合并区域中。但是按点的顺序来看，<code>H1</code> 的合并先发生，由于已合并区域会形成边界，这时 <code>N2</code> 进行合并的话，不可能再次包含点 <code>H1</code>。</p>
<p>通过以上示例可以看出，起始点的合并开始顺序，确实会影响最终的合并结果。因此，在每次合并完成后，都需要对已存在的点和新生成的两个点，进行一次排序，用以决定究竟哪个点该进入下一次的合并。</p>
<p>每个点都有一个横坐标与纵坐标，很容易想到的方法是，仅比较每个点的横坐标，越小的点，越先开始合并；或者仅比较每个点的纵坐标，越小的点，越先开始合并。但如果有两个点的某个坐标相同，又恰巧以该坐标决定合并顺序呢，很容易想到，比较应该同时结合横坐标与纵坐标，但以某一项为主；就像如果以横坐标为主，那么横坐标的值充当十位，纵坐标的值充当个位，用以区分其权重。</p>
<p>显然，如果横坐标的排序权重高，我们称为“横向合并优先”，那么每次分裂之后，横向的点都会进入下一个合并队列，纵向的点，进入等待队列，直到横向的数据达到数据范围的极限，此时，等待队列中的开始点，类似下列情况：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Nn - H1 - H2 - H3 - - - Hn</span><br></pre></td></tr></table></figure>
<p>横向数据范围越大，<code>Hn</code> 中 <code>n</code> 的值越大，等待合并的点越多。如果纵坐标的排序权重高，我们称为“横向合并优先”，情况依然类似。</p>
<p>其实，只要合并不是无序的，无论是横向优先，还是纵向优先，对合并结果的影响并不是很大，尤其是在停止行规则充分时，基本可以达到相同的合并结果。不过因为横向与纵向数据范围的差异，可能导致待合并队列中点的个数差异，进一步影响点排序的效率，因此，此处可以有一个优化，来使排序的效率增加，就是以数据范围小的坐标作为合并优先序。</p>
<h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><p>基于上述思想。我们简单理一下，该如何编码来实现本功能。</p>
<h2 id="基本对象"><a href="#基本对象" class="headerlink" title="基本对象"></a>基本对象</h2><h3 id="单元格对象"><a href="#单元格对象" class="headerlink" title="单元格对象"></a>单元格对象</h3><p>该对象用来表示点，他需要有一个横坐标属性，纵坐标属性，还需要能计算出左侧的点，右侧的点，以及两个点是否是同一个点。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cell</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $x;</span><br><span class="line">    <span class="keyword">protected</span> $y;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($x = <span class="number">0</span>, $y = <span class="number">0</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;x = $x;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;y = $y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getX</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getY</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">nextHorizonCell</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Cell(<span class="keyword">$this</span>-&gt;x + <span class="number">1</span>, <span class="keyword">$this</span>-&gt;y);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">nextVerticalCell</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Cell(<span class="keyword">$this</span>-&gt;x, <span class="keyword">$this</span>-&gt;y + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">equal</span><span class="params">(Cell $cell)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;x == $cell-&gt;getX() &amp;&amp; <span class="keyword">$this</span>-&gt;y == $cell-&gt;getY();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个实现并没有任何对点的值的表示，为何要这样处理，我们放在后面来说。</p>
<h3 id="区域对象"><a href="#区域对象" class="headerlink" title="区域对象"></a>区域对象</h3><p>区域表示的是一个范围，他有一个开始的点，与结束的点。同时他还需要有获取分裂后的点的能力，需要有判断点是否落在区域中的能力。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Cell</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Range</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $start;</span><br><span class="line">    <span class="keyword">public</span> $end;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $active;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $maxX = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Cell $start, Cell $end)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;start = $start;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;end   = <span class="keyword">$this</span>-&gt;active   = $end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">haveCell</span><span class="params">(Cell $cell)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $cellX = $cell-&gt;getX();</span><br><span class="line">        $cellY = $cell-&gt;getY();</span><br><span class="line"></span><br><span class="line">        $startX = <span class="keyword">$this</span>-&gt;start-&gt;getX();</span><br><span class="line">        $startY = <span class="keyword">$this</span>-&gt;start-&gt;getY();</span><br><span class="line"></span><br><span class="line">        $endX = <span class="keyword">$this</span>-&gt;end-&gt;getX();</span><br><span class="line">        $endY = <span class="keyword">$this</span>-&gt;end-&gt;getY();</span><br><span class="line">        <span class="keyword">if</span> ($cellX &gt;= $startX &amp;&amp; $cellX &lt;= $endX &amp;&amp; $cellY &gt;= $startY &amp;&amp; $cellY &lt;= $endY) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isCell</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;start-&gt;getX() == <span class="keyword">$this</span>-&gt;end-&gt;getX() &amp;&amp; <span class="keyword">$this</span>-&gt;start-&gt;getY() == <span class="keyword">$this</span>-&gt;end-&gt;getY()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">horizonTouchAllow</span><span class="params">(Cell $cell)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;maxX != <span class="number">0</span> &amp;&amp; $cell-&gt;getX() &gt; <span class="keyword">$this</span>-&gt;maxX) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">markMaxHorizonTouch</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;maxX = <span class="keyword">$this</span>-&gt;maxX == <span class="number">0</span> ? <span class="keyword">$this</span>-&gt;active-&gt;getX() : min(<span class="keyword">$this</span>-&gt;maxX, <span class="keyword">$this</span>-&gt;active-&gt;getX());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getValue</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            [<span class="keyword">$this</span>-&gt;start-&gt;getX(), <span class="keyword">$this</span>-&gt;start-&gt;getY()],</span><br><span class="line">            [<span class="keyword">$this</span>-&gt;end-&gt;getX(), <span class="keyword">$this</span>-&gt;end-&gt;getY()],</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">nextRowFirst</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $x = <span class="keyword">$this</span>-&gt;start-&gt;getX();</span><br><span class="line">        $y = <span class="keyword">$this</span>-&gt;end-&gt;getY() + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Cell($x, $y);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">nextColumnFirst</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $x = <span class="keyword">$this</span>-&gt;end-&gt;getX() + <span class="number">1</span>;</span><br><span class="line">        $y = <span class="keyword">$this</span>-&gt;start-&gt;getY();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Cell($x, $y);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">nextMergeStartCells</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $nextRowFirst    = <span class="keyword">$this</span>-&gt;nextRowFirst();</span><br><span class="line">        $nextColumnFirst = <span class="keyword">$this</span>-&gt;nextColumnFirst();</span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">            $nextColumnFirst,</span><br><span class="line">            $nextRowFirst,</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="数据源对象"><a href="#数据源对象" class="headerlink" title="数据源对象"></a>数据源对象</h3><p>数据源对象，就是给定的初始二维数据。只不过我们在编码时，不应该把它具体化，只需要知道，这个对象需要提供哪些功能。因此，数据源对象是什么。我们并不关心，但他需要实现这个接口：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Cell</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">RepositoryInterface</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 获取点的值</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getValue</span><span class="params">(Cell $cell)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取数据横向范围</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getWidth</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取数据纵向范围</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getHeight</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里来解释一下，为何单元格对象并不能获取自身的值？因为源数据有可能需要一个很大的存储空间，如果单元格能获取到值，必然需要在某处引用这一数据源，此时，<code>Cell</code> 类会对外部产生一个依赖，并且需要在实例化时主动传入该数据对象。而在执行过程中，会出现大量的点对象，由此可能导致内存占用增加，所以，将单元格的取值过程转嫁给数据源对象。</p>
<h3 id="搜索执行对象"><a href="#搜索执行对象" class="headerlink" title="搜索执行对象"></a>搜索执行对象</h3><p>对给定数据源执行搜索，其中包含代码主要的逻辑部分。</p>
<h3 id="停止规则对象"><a href="#停止规则对象" class="headerlink" title="停止规则对象"></a>停止规则对象</h3><p>停止规则对象依赖给定数据源，用以计算出动态的停止规则。</p>
<h2 id="执行过程"><a href="#执行过程" class="headerlink" title="执行过程"></a>执行过程</h2><h3 id="合并的初始化与进行"><a href="#合并的初始化与进行" class="headerlink" title="合并的初始化与进行"></a>合并的初始化与进行</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">start</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 将点 O(0,0) 放入横向合并队列</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;horizonMergeQueue[] = <span class="keyword">new</span> Cell;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开始检查合并</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;catchMergeRange();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回合并区域列表</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;mergedRanges;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">catchMergeRange</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 判断下一个要合并的起始点</span></span><br><span class="line">    $startCell = <span class="keyword">$this</span>-&gt;getNextMergeStart();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果不存在，表示合并结束</span></span><br><span class="line">    <span class="keyword">if</span> ($startCell) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果点不存在于已合并的区域中</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;merged($startCell)) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 初始化待合并区域</span></span><br><span class="line">            $range = <span class="keyword">new</span> Range($startCell, $startCell);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 可合并区域的寻找 - 区域终点搜索</span></span><br><span class="line">            $range = <span class="keyword">$this</span>-&gt;touchRange($range);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 判断区域是否是一个点，如果不是，则加入已合并区域列表</span></span><br><span class="line">            <span class="keyword">if</span> (!$range-&gt;isCell()) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;mergedRanges[<span class="keyword">$this</span>-&gt;getRangeId($range)] = $range;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 起始点分裂</span></span><br><span class="line">            <span class="keyword">list</span>($cellHorizon, $cellVertical) = $range-&gt;nextMergeStartCells();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将点$cellHorizon 加入横向合并队列</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;isExistsCell($cellHorizon)) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;horizonMergeQueue[<span class="keyword">$this</span>-&gt;getCellHorizonIndex($cellHorizon)] = $cellHorizon;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;makeExtendStopRule($cellHorizon);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将点$cellVertical 加入纵向合并队列</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;isExistsCell($cellVertical)) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;verticalMergeQueue[<span class="keyword">$this</span>-&gt;getCellVerticalIndex($cellVertical)] = $cellVertical;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;makeExtendStopRule($cellVertical);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 启动下一个起始点的合并</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;catchMergeRange();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">touchRange</span><span class="params">(Range $range)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 区域内 - 横向检查</span></span><br><span class="line">    $range = <span class="keyword">$this</span>-&gt;touchCellHorizon($range);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 区域内 - 纵向检查</span></span><br><span class="line">    $range = <span class="keyword">$this</span>-&gt;touchCellVertical($range);</span><br><span class="line">    <span class="keyword">return</span> $range;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 纵向检查</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">touchCellHorizon</span><span class="params">(Range $range)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $nextHorizonCell = $range-&gt;active-&gt;nextHorizonCell();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 达到纵向数据范围的极限，检查停止</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;isExistsCell($nextHorizonCell)) &#123;</span><br><span class="line">        $range-&gt;end = $range-&gt;active;</span><br><span class="line">        <span class="keyword">return</span> $range;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 纵向检查通过，启动横向检查，在这里检查停止行规则</span></span><br><span class="line">    <span class="keyword">if</span> ($range-&gt;horizonTouchAllow($nextHorizonCell) &amp;&amp;</span><br><span class="line">        !<span class="keyword">$this</span>-&gt;atStopColumn($nextHorizonCell) &amp;&amp;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;getValue($range-&gt;active) === <span class="keyword">$this</span>-&gt;getValue($nextHorizonCell)) &#123;</span><br><span class="line">        $range-&gt;active = $nextHorizonCell;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;touchCellHorizon($range);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 否则检查停止</span></span><br><span class="line">        $range-&gt;end = $range-&gt;active;</span><br><span class="line"></span><br><span class="line">        $range-&gt;markMaxHorizonTouch();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $range;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 横向检查</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">touchCellVertical</span><span class="params">(Range $range)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $nextRowFirst = $range-&gt;nextRowFirst();</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;isExistsCell($nextRowFirst)) &#123;</span><br><span class="line">        <span class="keyword">return</span> $range;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 横向检查通过，继续下一轮检查，在这里检查停止行规则</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;atStopRow($nextRowFirst) &amp;&amp; <span class="keyword">$this</span>-&gt;getValue($range-&gt;start) === <span class="keyword">$this</span>-&gt;getValue($nextRowFirst)) &#123;</span><br><span class="line">        $range-&gt;active = $nextRowFirst;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;touchRange($range);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $range;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取下一个起始点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNextMergeStart</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;horizonMergeQueue) &amp;&amp; <span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;verticalMergeQueue)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">$this</span>-&gt;mergeDirect == <span class="keyword">self</span>::HORIZON_DIRECT &amp;&amp; !<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;horizonMergeQueue)) || <span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;verticalMergeQueue)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;getNextMergeStartOfQueue(<span class="keyword">$this</span>-&gt;horizonMergeQueue);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;getNextMergeStartOfQueue(<span class="keyword">$this</span>-&gt;verticalMergeQueue);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 去除起始点时，先进行一次排序</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getNextMergeStartOfQueue</span><span class="params">(&amp;$queue)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    krsort($queue);</span><br><span class="line">    <span class="keyword">return</span> array_pop($queue);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 是否是停止列</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">atStopColumn</span><span class="params">(Cell $cell)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;stopRule-&gt;atStopColumn($cell);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 是否是停止行</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">atStopRow</span><span class="params">(Cell $cell)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;stopRule-&gt;atStopRow($cell);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里只列出了主要的检查逻辑。</p>
<h3 id="停止行规则"><a href="#停止行规则" class="headerlink" title="停止行规则"></a>停止行规则</h3><p>停止规则对象</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StopRule</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">ExcelBaseOperate</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> $exporter;</span><br><span class="line">    <span class="keyword">protected</span> $stopColumn = [];</span><br><span class="line">    <span class="keyword">protected</span> $stopRow    = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $extendStopRows = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $extendStopColumns = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($exporter)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;exporter = $exporter;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($exporter-&gt;extendStopRows) &amp;&amp; $exporter-&gt;extendStopRows) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;extendStopRows = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($exporter-&gt;extendStopColumns) &amp;&amp; $exporter-&gt;extendStopColumns) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;extendStopColumns = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 传入一个点对象，用来检查是否处于停止行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">atStopColumn</span><span class="params">(Cell $cell)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 如果数据源对象实现了规则，则获取数据源的规则，并解析停止结果</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;exporter <span class="keyword">instanceof</span> WithStopRule) &#123;</span><br><span class="line">            $rule       = <span class="keyword">$this</span>-&gt;exporter-&gt;stopColumns();</span><br><span class="line">            $shouldStop = <span class="keyword">$this</span>-&gt;parserStopColumnRule($rule, $cell);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ($shouldStop) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (in_array($cell-&gt;getX(), <span class="keyword">$this</span>-&gt;stopColumn)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 传入一个点对象，用来检查是否处于停止列</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">atStopRow</span><span class="params">(Cell $cell)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 如果数据源对象实现了规则，则获取数据源的规则，并解析停止结果</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;exporter <span class="keyword">instanceof</span> WithStopRule) &#123;</span><br><span class="line">            $rule       = <span class="keyword">$this</span>-&gt;exporter-&gt;stopRows();</span><br><span class="line">            $shouldStop = <span class="keyword">$this</span>-&gt;parserStopRowRule($rule, $cell);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ($shouldStop) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (in_array($cell-&gt;getY(), <span class="keyword">$this</span>-&gt;stopRow)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">addStopColumn</span><span class="params">($index)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;stopColumn[$index] = $index;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">addStopRow</span><span class="params">($index)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;stopRow[$index] = $index;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 按数据源规则解析停止结果</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">parserStopColumnRule</span><span class="params">($rule, Cell $cell)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 规则为布尔值，表示始终停止或不停止</span></span><br><span class="line">        <span class="keyword">if</span> (is_bool($rule)) &#123;</span><br><span class="line">            <span class="keyword">return</span> $rule;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 规则为数组，表示指定的停止行号或ID</span></span><br><span class="line">        <span class="keyword">if</span> (is_array($rule)) &#123;</span><br><span class="line">            <span class="keyword">foreach</span> ($rule <span class="keyword">as</span> $item) &#123;</span><br><span class="line">                <span class="keyword">if</span> (is_numeric($item) &amp;&amp; $cell-&gt;getX() == $item) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;isColumnName($item) &amp;&amp; <span class="keyword">$this</span>-&gt;columnNameToIndex($item) == $cell-&gt;getX()) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 规则为一个可执行结构，由数据源自身计算是否需要停止</span></span><br><span class="line">        <span class="keyword">if</span> (is_callable($rule)) &#123;</span><br><span class="line">            <span class="keyword">return</span> call_user_func_array($rule, [$cell-&gt;getX(), $cell-&gt;getY()]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">parserStopRowRule</span><span class="params">($rule, Cell $cell)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (is_bool($rule)) &#123;</span><br><span class="line">            <span class="keyword">return</span> $rule;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (is_array($rule)) &#123;</span><br><span class="line">            <span class="keyword">foreach</span> ($rule <span class="keyword">as</span> $item) &#123;</span><br><span class="line">                <span class="keyword">if</span> (is_numeric($item) &amp;&amp; $cell-&gt;getY() == $item) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (is_callable($rule)) &#123;</span><br><span class="line">            <span class="keyword">return</span> call_user_func_array($rule, [$cell-&gt;getY(), $cell-&gt;getX()]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在进行停止行的判定时，有这样的一部分代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;exporter <span class="keyword">instanceof</span> WithStopRule) &#123;</span><br><span class="line">    $rule       = <span class="keyword">$this</span>-&gt;exporter-&gt;stopRows();</span><br><span class="line">    $shouldStop = <span class="keyword">$this</span>-&gt;parserStopRowRule($rule, $cell);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($shouldStop) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中 <code>exporter</code> 就是一开始给定的原始数据对象，如果该对象实现了 <code>WithStopRule</code> 接口的话，表名该对象定义了自己的停止规则，通过 <code>stopRows/stopColumns</code> 方法获取到原始数据定义的停止规则 <code>$rule</code>，然后将 <code>$rule</code>和当前的点 <code>$cell</code> 传给 <code>parserStopRowRule</code> 方法，计算出在当前点 <code>$cell</code> 是否需要停止。</p>
<p>最终代码结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/</span><br><span class="line">|----/Concerns/</span><br><span class="line">|--------/ExtendStopColumns.php·············停止列继承</span><br><span class="line">|--------/ExtendStopRows.php················停止行继承</span><br><span class="line">|--------/RepositoryInterface.php···········源数据对象接口</span><br><span class="line">|--------/WithStopRule.php··················停止规则定义接口</span><br><span class="line">|----/Merge/</span><br><span class="line">|--------/Discover.php······················搜索过程定义</span><br><span class="line">|--------/StopRule.php······················停止规则解析</span><br><span class="line">|----/Repositories/</span><br><span class="line">|--------/ArrayRepository.php···············二维数组源数据包装对象</span><br><span class="line">|--------/WorksheetRepository.php···········Excel工作表源数据包装对象</span><br><span class="line">|----/Table/</span><br><span class="line">|--------/Cell.php··························基础点对象</span><br><span class="line">|--------/Range.php·························基础区域对象</span><br><span class="line">|----/Table/</span><br><span class="line">|--------/ExcelBaseOperate.php··············行与列操作方法</span><br></pre></td></tr></table></figure>
<p>完整代码请转<a href="https://gitlab.uuzu.com/songzhp/laravel-excel-merge" target="_blank" rel="noopener">gitlab.uuzu.com/songzhp/laravel-excel-merge</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.slpi1.com/20210219/custom/readme.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="slpi1">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="easy note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/20210219/custom/readme.html" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-02-19T15:44:38+08:00">
                2021-02-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="编码习惯"><a href="#编码习惯" class="headerlink" title="编码习惯"></a>编码习惯</h1><ul>
<li>单引号与双引号的使用：纯字符串使用单引号包括，而不是使用双引号。</li>
<li><p>字符串与变量的拼接：</p>
<ul>
<li>通过点号(.)连接字符串与变量。</li>
<li>双引号的写法，变量使用中括号包括。<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$str = <span class="string">"Hello World. I'm &#123;$name&#125;."</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>同一个方法体内不要用相同的变量表示不同的含义。</p>
</li>
<li><p>foreach循环数组时，as后面避免使用引用。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> ($array <span class="keyword">as</span> $key =&gt; &amp; $value) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编码过程中进行逻辑运算时，尽量避免出现无意义的罗马数值，通过使用常量来代替。此外，其他地方为了表意明确，都推荐做如上处理。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//错误示范</span></span><br><span class="line"><span class="keyword">if</span> ($user-&gt;type == <span class="number">1</span>) &#123;</span><br><span class="line">   $isAdmin = <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确示范</span></span><br><span class="line"><span class="class"><span class="keyword">Class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">   <span class="keyword">const</span> TYPE_ADMIN = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ($user-&gt;type == User::TYPE_ADMIN) &#123;</span><br><span class="line">   $isAdmin = <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>对类型明确的函数参数，进行类型声明。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//错误示范</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserName</span><span class="params">($user)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $user-&gt;name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确示范</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserName</span><span class="params">(User $user)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $user-&gt;name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.slpi1.com/20210219/discuss/config.draft.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="slpi1">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="easy note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/20210219/discuss/config.draft.html" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-02-19T15:44:38+08:00">
                2021-02-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="可配置化"><a href="#可配置化" class="headerlink" title="可配置化"></a>可配置化</h1><p>可配置化包含的内容非常广泛，这里我们仅仅讨论几个目前可能对我们有用的几个方面。</p>
<h2 id="配置项"><a href="#配置项" class="headerlink" title="配置项"></a>配置项</h2><p>一个项目在测试环境与正式环境的访问入口是不同的，像这样的变量我们都会准备一个专门的配置文件来保存，比如laravel中的.env文件。通过配置文件，来达到修改变量，而不是修改代码的目的。</p>
<p>曾经流行的PHP系统中，往往会提供在后台管理配置项的功能，将配置项保存在数据库中，现今已不推荐使用这种方式。一来之前的系统很多是面向非程序员的站长的，所以需要配置可视化，但我们目前的系统都是有编程基础的人员进行管理的，直接修改配置文件并不存在门槛；其次，如果通过后台保存在数据库中，需要先连接数据库，然后才能读取配置项，在运行机制上会有一个先后问题，所以并非任意的配置项都能保存到数据库。</p>
<p>一般来说，配置项会满足下列特征中的一个或几个:</p>
<ul>
<li>可调整的值。 </li>
<li>环境变量。 系统入口、环境名称、debug等。</li>
<li>服务间耦合信息。 数据库信息、reids信息等。</li>
</ul>
<h2 id="配置对象"><a href="#配置对象" class="headerlink" title="配置对象"></a>配置对象</h2><p>配置对象，系统管理后台的所有功能，都可以抽象成对配置对象的管理。拿用户管理功能举例来说：</p>
<ul>
<li>新增用户：为系统新增一个用户对象。</li>
<li>删除用户：删除系统中的某个用户对象。</li>
<li>修改用户密码：修改系统中存在的用户对象的密码属性。</li>
</ul>
<p>配置对象是如何抽象出来的呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">分析系统需求 -&gt; 构建系统逻辑 -&gt; 抽象系统所需对象 -&gt; 明确对象的属性 -&gt; 对象对应数据库中的表，对象属性对应数据表的字段</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.slpi1.com/20210219/2017年终总结.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="slpi1">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="easy note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/20210219/2017年终总结.html" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-02-19T15:44:38+08:00">
                2021-02-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="2017年终总结"><a href="#2017年终总结" class="headerlink" title="2017年终总结"></a>2017年终总结</h1><h2 id="工作成绩"><a href="#工作成绩" class="headerlink" title="工作成绩"></a>工作成绩</h2><p>2017年主要参与了SDK的维护与升级，H5SDK的开发与维护，聚合SDK的开发与维护，说说英语的相关功能的参与。</p>
<h2 id="经验教训"><a href="#经验教训" class="headerlink" title="经验教训"></a>经验教训</h2><p>SDK的维护与升级，从第一版到第二版有很大的改进。第一是用户体系的升级：经历了从用户名登录到用户名或手机登录的的过程。这一功能的改进，主要是为了解决用户名密码注册流程繁琐，随机注册容易忘记账号的问题。通过手机直接注册，一来可以省去输入密码的环节，二来可以解决用户忘记账号的情况。我觉的在实现过程中出现了一些状况，主要是用户名和手机两个字段的冲突问题。应该一开始就区分注册的来源与登录的来源，比如通过验证码的话，必然是通过手机号进行的操作，那么与之对应的唯一标示字段就是mobile，如果是通过密码进行的操作，与之对应的唯一标示就是用户名。执行这一策略也许会在操作流程上引入一些环节，但是可以避免在系统中引入bug的可能。第二是新增游戏盒子的功能，盒子的定制功能的引入，如果要贯彻下去，应该是要有很大的技术资源投入的，否则不足以支撑比较广泛的定制需求，而基础的定制功能对需求方来说会比较鸡肋。所以现在盒子基本上是只有自己在使用的一个功能。第三是关于SDK后台的问题，随着项目的扩大，功能的增多，后台集成的功能越来越多，对于非技术的使用者来说，不一定了解每一个功能如何使用，对于新进来的管理员来说，需要重复的教。从角色的功能的角度出发，可以按照每个角色的权限范围来做一套系统的使用说明文档。</p>
<p>H5SDK基于SDK已有的功能来进行。由于一开始对目标与需求的不明确导致后续的一系列问题。第一是h5的回调通知与原有游戏App的回调通知格式不一致，导致在与游戏厂商对接的过程中需要做两份不同的文档，给对接的过程增加困扰。第二是一开始没有考虑到h5游戏同时会有App包的情况，在分发的环节出现两个入口的问题，一个apk下载入口，一个web在线入口，并且在对接的时候游戏方要对接两套文档。而且现在已经累积了很多上线的H5游戏，从根本上来解决这个问题变得比较困难了。</p>
<p>在开发H5SDK的过成功，使用到了前端框架VUE，掌握了基本的使用。VUE适用于前端驱动的项目，需要分离前后端，与App的通讯类似，但是由于浏览器端的开放性，在浏览器端做比较复杂的加密并不现实，需要引入其他的安全保障机制。关于VUE的一些使用心得，有一下几点</p>
<ul>
<li>比较轻量级，有比较全面的中文文档支持，入门比较方便。</li>
<li>在项目构架层面没有做出太多规范，如果使用者在这一方面的能力不足，会随着项目规模的扩大变得越来越难维护。</li>
<li>建议在一些小的项目中做尝试，累积经验。</li>
</ul>
<p>在做聚合SDK的开发前期，对这一项目的目标与流程有一个完整深入的了解，结合前期SDK开发过程中的经验，规避了一下可能会踩到的坑。项目开发过程中，始终贯彻的一个理念是解构。解构整个流程分为两大部分，与渠道的对接和与CP的对接。两个过程由两个相互解耦的模块负责：<code>AgentSdk</code>/<code>PSdk</code>。<code>AgentSdk</code> 负责平台与渠道的对接过程中的签名、验签、参数转换等功能。<code>PSdk</code>负责与CP对接过程中的签名、验签、参数转换等功能。开发过程中先按照思路整理出必要的文档，随着项目的推进不断对文档进行修改与完善。最终开发完毕，重复使用文档到内部对接、外部对接的过程中去，是一次比较愉快的编程体验。</p>
<p>由于前期需求中有web聊天的功能，找到了一些开源的框架来完成，期间接触到Angular。Angular与VUE是统一类框架。关于Angular的一下使用心得：</p>
<ul>
<li>Angular新版本是基于TypeScript来实现，对开发者更友好。</li>
<li>Angular框架本身包含了很多模块与组件，功能非常强大。</li>
<li>Angular框架本身在项目构架层面做了很多的工作，开发过程中参考文档来实现，可以是项目进展更顺利，对于大型的前端项目来说是比较好的选择。</li>
</ul>
<p>在工作之余了解了一下laravel，并阅读了部分模块的源码，对laravel有了一个比较基础的认识。laravel借鉴了很多其他语言的优秀框架的实现，包括container，provider这些概念，以及依赖注入的实现等等。laravel的编码非常规范，用到的一些设计模式和一些编程技巧，用很大的使用价值。即使不能使用到项目中，也建议有时间去了解一下，是非常好的学习资料。</p>
<h2 id="今后打算"><a href="#今后打算" class="headerlink" title="今后打算"></a>今后打算</h2><p>多学多看多动手，敢于尝试，从各个方面积极寻找可以提升工作效率的更好的手段。</p>
<h2 id="个人建议"><a href="#个人建议" class="headerlink" title="个人建议"></a>个人建议</h2><ul>
<li>线下小组分享的内容要讨论提取精华后运用到工作中去。</li>
<li>可以尝试将前后分离的实践</li>
<li>API通讯过程中可以采用其他的安全措施，目前RSA的加密方式，对于带参数调试的情况支持不够。</li>
<li>API版本与文档的管理</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.slpi1.com/20151005/php与curl.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="slpi1">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="easy note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/20151005/php与curl.html" itemprop="url">php的curl使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-10-05T10:36:00+08:00">
                2015-10-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          php，curl
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/20151005/php与curl.html">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.slpi1.com/20150924/php基础-文档操作.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="slpi1">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="easy note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/20150924/php基础-文档操作.html" itemprop="url">php基础 - 文档操作</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-09-24T14:30:00+08:00">
                2015-09-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          php对文档及目录的操作。
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/20150924/php基础-文档操作.html">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.slpi1.com/20150924/php基础-时间与日期.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="slpi1">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="easy note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/20150924/php基础-时间与日期.html" itemprop="url">php基础 - 时间与日期</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-09-24T12:30:00+08:00">
                2015-09-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          php基础，时间与日期，常用时间日期函数以及时间日期对象。
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/20150924/php基础-时间与日期.html">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.slpi1.com/20150924/php基础-字符串函数.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="slpi1">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="easy note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/20150924/php基础-字符串函数.html" itemprop="url">php基础 - 常用字符串函数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-09-24T12:30:00+08:00">
                2015-09-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          php基础，常用字符串函数
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/20150924/php基础-字符串函数.html">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.slpi1.com/20150923/PHP基础.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="slpi1">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="easy note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/20150923/PHP基础.html" itemprop="url">php基础</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-09-23T14:50:00+08:00">
                2015-09-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          php基础知识点。数据类型及转换、数组及相关函数、OOP及高级特性。
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/20150923/PHP基础.html">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="slpi1" />
          <p class="site-author-name" itemprop="name">slpi1</p>
           
              <p class="site-description motion-element" itemprop="description">PHP,Laravel,thinkPHP,javascript,css</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">42</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">slpi1</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
